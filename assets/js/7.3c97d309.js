(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{173:function(t,a,e){"use strict";e.r(a);var s=e(0),n=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),e("p",[t._v("認可コードを受け取るためには、まずユーザ側に認可コード発行の同意を求める必要があります。\n"),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(" を元に同意を求める画面への URL を作成し、ユーザに同意を求めます。")],1),t._v(" "),e("p",[t._v("ユーザ側で同意が行われると上記 URL 作成時に指定した redirect_uri へリダイレクトされ、query string より認可コード(code)を取得できます。")]),t._v(" "),e("p",[t._v("例)\nhttps://example.com/oauth?code=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")]),t._v(" "),t._m(5),t._v(" "),e("p",[t._v("事前に "),e("a",{attrs:{href:"http://alis.to/me/settings/applications",target:"_blank",rel:"noopener noreferrer"}},[t._v("アプリケーション登録"),e("OutboundLink")],1),t._v("にて登録したアプリケーション（クライアントタイプ：サーバーサイドアプリケーション）より、Client ID と Client Secret を取得します。\nこの Client ID と Client Secret を元に https://alis.to/oauth2/token へ下記例を参考にリクエストし、Access Token, Refresh Token, ID tokenを取得します。")]),t._v(" "),e("p",[t._v("リクエスト例")]),t._v(" "),t._m(6),e("ul",[e("li",[t._v('Authorization: Client IDと Client Secretを":"(コロン)で連結し、Base64エンコードした値')]),t._v(" "),e("li",[t._v("code: 手順1で取得した認可コード")]),t._v(" "),e("li",[t._v("redirect_uri: "),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(") で指定した redirect_uri")],1),t._v(" "),e("li",[t._v("code_verifier: "),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(" で作成した code_verifier")],1)]),t._v(" "),t._m(7),t._v(" "),e("p",[t._v("ID token の署名を検証します。検証方法については "),e("router-link",{attrs:{to:"/idtoken-verify/"}},[t._v("ID token の検証")]),t._v("を確認ください。")],1),t._v(" "),t._m(8),t._v(" "),e("p",[t._v("取得したアクセストークン(Access Token)を Authorization: Bearer ヘッダに付与することで、API 実行を行えます。\n実行できる API は同意時に指定した scope によって異なります。詳細は"),e("router-link",{attrs:{to:"/scopes/"}},[t._v("権限一覧")]),t._v("を確認ください。")],1),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),e("p",[t._v("認可コードを受け取るためには、まずユーザ側に認可コード発行の同意を求める必要があります。\n"),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(" を元に同意を求める画面への URL を作成し、ユーザに同意を求めます。")],1),t._v(" "),e("p",[t._v("ユーザ側で同意が行われると上記 URL 作成時に指定した redirect_uri へリダイレクトされ、query string より認可コード（code）を取得できます。")]),t._v(" "),e("p",[t._v("例)\napp://example.com/oauth?code=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")]),t._v(" "),t._m(14),t._v(" "),e("p",[t._v("事前に "),e("a",{attrs:{href:"http://alis.to/me/settings/applications",target:"_blank",rel:"noopener noreferrer"}},[t._v("アプリケーション登録"),e("OutboundLink")],1),t._v("にて登録したアプリケーション（クライアントタイプ：ネイティブアプリケーション）より、Client ID を取得します。\nこの Client ID を元に https://alis.to/oauth2/token へ下記例を参考にリクエストし、Access Token, Refresh Token, ID tokenを取得します。")]),t._v(" "),e("p",[t._v("リクエスト例")]),t._v(" "),t._m(15),e("ul",[e("li",[t._v("client_id: 登録したアプリケーションに紐づく Client ID")]),t._v(" "),e("li",[t._v("code: 手順1で取得した認可コード")]),t._v(" "),e("li",[t._v("redirect_uri: "),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(" で指定した redirect_uri")],1),t._v(" "),e("li",[t._v("code_verifier: "),e("router-link",{attrs:{to:"/authorization-url/"}},[t._v("同意画面へのURL作成方法")]),t._v(" で作成した code_verifier")],1)]),t._v(" "),t._m(16),t._v(" "),e("p",[t._v("ID token の署名を検証します。検証方法については "),e("router-link",{attrs:{to:"/idtoken-verify/"}},[t._v("ID token の検証")]),t._v("を確認ください。")],1),t._v(" "),t._m(17),t._v(" "),e("p",[t._v("取得したアクセストークン(Access Token)を Authorization: Bearer ヘッダに付与することで、API 実行を行えます。\n実行できる API は同意時に指定した scope によって異なります。詳細は"),e("router-link",{attrs:{to:"/scopes/"}},[t._v("権限一覧")]),t._v("を確認ください。")],1),t._v(" "),t._m(18),t._m(19),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.authlete.com/documents/article/pkce",target:"_blank",rel:"noopener noreferrer"}},[t._v("PKCE"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://tools.ietf.org/html/rfc6749#section-4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Authorization Code Grant"),e("OutboundLink")],1)])])])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"oauth2-0-を利用した-api-実行手順"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth2-0-を利用した-api-実行手順","aria-hidden":"true"}},[this._v("#")]),this._v(" OAuth2.0 を利用した API 実行手順")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"サーバサイドアプリケーション向け"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#サーバサイドアプリケーション向け","aria-hidden":"true"}},[this._v("#")]),this._v(" サーバサイドアプリケーション向け")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要","aria-hidden":"true"}},[this._v("#")]),this._v(" 概要")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("「Authorization Code Grant + PKCE + ClientSecret」にて認可を行い、API を実行します。\nこの認可の詳細については"),a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%EF%BC%9A-%E8%AA%8D%E5%8F%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"}},[this._v("参考： 認可フローについて")]),this._v("を参照ください。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順１：認可コード取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順１：認可コード取得","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順１：認可コード取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順２：アクセストークンの取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順２：アクセストークンの取得","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順２：アクセストークンの取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("POST /oauth2/token HTTP/1.1\nHost: alis.to\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic xxxxxxxxxxxxxxxxx\n \ngrant_type=authorization_code\n&code=xxxxxxxxxxxxxxx\n&redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb\n&code_verifier=7vN7KSmEl5qFeHeRZmfMsR7fl_BsluESjvl32W9el5A6WgsAbXCaqwK43BmXjs7cGw9hTQC9xmVb41xi8fL4CA\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順３：id-tokenの検証"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順３：id-tokenの検証","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順３：ID tokenの検証")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順４：api-実行サンプル"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順４：api-実行サンプル","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順４：API 実行サンプル")])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    headers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`Bearer ")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("access_token"),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json; charset=utf-8"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"ネイティブアプリケーション向け"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ネイティブアプリケーション向け","aria-hidden":"true"}},[this._v("#")]),this._v(" ネイティブアプリケーション向け")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"概要-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 概要")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("ネイティブアプリケーションは ClientSecret を秘匿できないので、\n「Authorization Code Grant + PKCE」にて認可を行い、API を実行します。\nこの認可の詳細については"),a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%EF%BC%9A-%E8%AA%8D%E5%8F%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"}},[this._v("参考： 認可フローについて")]),this._v("を参照ください。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順１：認可コード取得-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順１：認可コード取得-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順１：認可コード取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順２：アクセストークンの取得-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順２：アクセストークンの取得-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順２：アクセストークンの取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("POST /token HTTP/1.1\nHost: oauth2.alis.to\nContent-Type: application/x-www-form-urlencoded\n \ngrant_type=authorization_code\n&client_id=1234567890\n&code=xxxxxxxxxxxxxxx\n&redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb\n&code_verifier=7vN7KSmEl5qFeHeRZmfMsR7fl_BsluESjvl32W9el5A6WgsAbXCaqwK43BmXjs7cGw9hTQC9xmVb41xi8fL4CA\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順３：id-tokenの検証-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順３：id-tokenの検証-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順３：ID tokenの検証")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順４：api-実行サンプル-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順４：api-実行サンプル-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順４：API 実行サンプル")])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    headers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`Bearer ")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("access_token"),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json; charset=utf-8"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"参考：-認可フローについて"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考：-認可フローについて","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考： 認可フローについて")])}],!1,null,null,null);a.default=n.exports}}]);