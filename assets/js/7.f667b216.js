(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{173:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("サーバーサイドアプリケーションは認可コード取得のために、ユーザーをAuthorizationエンドポイントへリダイレクトさせます。\nユーザーがALIS画面上でアプリケーションのアクセスを許可した場合、認可コードをパラメーターとして付与したredirect_urlにアクセスします。\nサーバーサイドアプリケーションはパラメーターから認可コードを取得します。")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("事前に、サーバーサイドアプリケーション開発者はOAuth登録画面にて、「クライアントタイプ：サーバサイドアプリケーション」を指定し登録。Client ID と Client Secret が発行されていることを確認しメモしておきます。\nTokenエンドポイントにリクエストすることで、Access Token, Refresh Token, ID tokenを取得します。")]),t._v(" "),s("p",[t._v('リクエストは以下のように、Client IDと Client Secretを":"(コロン)で連結し、Base64エンコードしたものをAuthorizationヘッダに加えます。')]),t._v(" "),s("p",[t._v("リクエスト例")]),t._v(" "),t._m(6),t._m(7),t._v(" "),s("p",[t._v("ID tokenの署名を検証します。\n公開鍵はJWKsエンドポイントにて取得可能です。")]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("取得したアクセストークンをAuthorization: Bearer ヘッダを使ってAPIエンドポイントへリクエストを送信します。")]),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("ネィテイブアプリケーションは認可コード取得のために、ユーザーをAuthorizationエンドポイントへアクセスさせます。\nユーザーがALIS画面上でアプリケーションのアクセスを許可した場合、認可コードをパラメーターとして付与したredirect_urlにアクセスします。\nネィテイブアプリケーションはパラメーターから認可コードを取得します。")]),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("事前に、ネイティブアプリケーション開発者はOAuth登録画面にて、「クライアントタイプ：アネイティブアプリケーション」を指定し登録。Client ID が発行されていることを確認しメモしておきます。\nTokenエンドポイントにリクエストすることで、Access Token, Refresh Token, ID tokenを取得します。")]),t._v(" "),s("p",[t._v("リクエスト例")]),t._v(" "),t._m(15),t._m(16),t._v(" "),s("p",[t._v("ID tokenの署名を検証します。\n公開鍵はJWKsエンドポイントにて取得可能です。")]),t._v(" "),t._m(17),t._v(" "),s("p",[t._v("取得したアクセストークンをAuthorization: Bearer ヘッダを使ってAPIエンドポイントへリクエストを送信します。")]),t._v(" "),t._m(18),t._m(19),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.authlete.com/documents/article/pkce",target:"_blank",rel:"noopener noreferrer"}},[t._v("PKCE"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tools.ietf.org/html/rfc6749#section-4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Authorization Code Grant"),s("OutboundLink")],1)])])])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"oauth2-0-を利用した-api-実行手順"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth2-0-を利用した-api-実行手順","aria-hidden":"true"}},[this._v("#")]),this._v(" OAuth2.0 を利用した API 実行手順")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"サーバサイドアプリケーション向け"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#サーバサイドアプリケーション向け","aria-hidden":"true"}},[this._v("#")]),this._v(" サーバサイドアプリケーション向け")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要","aria-hidden":"true"}},[this._v("#")]),this._v(" 概要")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("「Authorization Code Grant + PKCE + ClientSecret」にて認可を行い、API アクセスを行います。\n認可フローの詳細については"),a("a",{attrs:{href:"#%E8%A3%9C%E8%B6%B3%EF%BC%9Aapi%E5%AE%9F%E8%A1%8C%E3%81%BE%E3%81%A7%E3%81%AE%E3%83%95%E3%83%AD%E3%83%BC"}},[this._v("api実行までのフロー")]),this._v("を参照してください")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順１：認可コード取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順１：認可コード取得","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順１：認可コード取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順２：アクセストークンの取得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順２：アクセストークンの取得","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順２：アクセストークンの取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("POST /token HTTP/1.1\nHost: oauth2.alis.to\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic xxxxxxxxxxxxxxxxx\n \ngrant_type=authorization_code\n&code=xxxxxxxxxxxxxxx\n&redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb\n&code_verifier=7vN7KSmEl5qFeHeRZmfMsR7fl_BsluESjvl32W9el5A6WgsAbXCaqwK43BmXjs7cGw9hTQC9xmVb41xi8fL4CA\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順３：id-tokenの検証"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順３：id-tokenの検証","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順３：ID tokenの検証")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順４：api-実行サンプル"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順４：api-実行サンプル","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順４：API 実行サンプル")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`Bearer ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("access_token"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json; charset=utf-8"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"ネイティブアプリケーション向け"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ネイティブアプリケーション向け","aria-hidden":"true"}},[this._v("#")]),this._v(" ネイティブアプリケーション向け")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"概要-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 概要")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("ネイティブアプリケーションはClientSecretを秘匿できないので、\n「Authorization Code Grant + PKCE」にて認可を行い、API アクセスを行います。\n認可フローの詳細については"),a("a",{attrs:{href:"#%E8%A3%9C%E8%B6%B3%EF%BC%9Aapi%E5%AE%9F%E8%A1%8C%E3%81%BE%E3%81%A7%E3%81%AE%E3%83%95%E3%83%AD%E3%83%BC"}},[this._v("api実行までのフロー")]),this._v("を参照してください")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順１：認可コード取得-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順１：認可コード取得-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順１：認可コード取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順２：アクセストークンの取得-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順２：アクセストークンの取得-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順２：アクセストークンの取得")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("POST /token HTTP/1.1\nHost: oauth2.alis.to\nContent-Type: application/x-www-form-urlencoded\n \ngrant_type=authorization_code\n&code=xxxxxxxxxxxxxxx\n&redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb\n&code_verifier=7vN7KSmEl5qFeHeRZmfMsR7fl_BsluESjvl32W9el5A6WgsAbXCaqwK43BmXjs7cGw9hTQC9xmVb41xi8fL4CA\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順３：id-tokenの検証-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順３：id-tokenの検証-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順３：ID tokenの検証")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"手順４：api-実行サンプル-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手順４：api-実行サンプル-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 手順４：API 実行サンプル")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`Bearer ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("access_token"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json; charset=utf-8"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"補足：api実行までのフロー"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#補足：api実行までのフロー","aria-hidden":"true"}},[this._v("#")]),this._v(" 補足：API実行までのフロー")])}],!1,null,null,null);a.default=e.exports}}]);